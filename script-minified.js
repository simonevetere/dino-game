document.body.onselectstart=function(){return!1};const canvas=document.getElementById("gameCanvas");var lives=3;const fireballs=[];let powerupActive=!1,powerupStartTime,fireballRadius=5,fireballSpeed=20,canShoot=!0;window.scrollTo(0,document.body.scrollHeight),window.addEventListener("scroll",function(){window.innerHeight+window.scrollY>=document.body.scrollHeight&&document.body.classList.add("no-scroll")}),canvas.height=window.innerHeight,canvas.width=window.innerWidth;const ctx=canvas.getContext("2d");let speedHard=1,playerSpeed=2,points=0;for(var playerImage=[],i=1;i<22;i++)playerImage[i]=new Image,playerImage[i].src="img/dino/"+i+".png";for(var playerRed=[],i=1;i<22;i++)playerRed[i]=new Image,playerRed[i].src="img/dino-red/"+i+".png";for(var obstacleImage=[],i=1;i<64;i++)obstacleImage[i]=new Image,obstacleImage[i].src="img/chicken/"+i+".png";for(var fireballImage=[],i=1;i<4;i++)fireballImage[i]=new Image,fireballImage[i].src="img/fireball/"+i+".png";const meteorImage=new Image;meteorImage.src="img/meteor.png";let meteorAngle=0,intervalRed=!1;const player={x:50,y:300,width:50,height:50,speed:playerSpeed,dx:0,dy:0,gravity:.5,jumpPower:-22,canJump:!0},ground={x:0,y:canvas.height-70,width:canvas.width,height:70},obstacles=[],meteore=[];function drawPlayer(){drawAnimatedImage(playerImage,player.x,player.y,0,0,64,64)}function drawPlayerRed(){drawAnimatedImage(playerRed,player.x,player.y,0,0,64,64)}const grassImage=new Image;function drawGround(){let e=ctx.createPattern(grassImage,"repeat");ctx.fillStyle=e,ctx.fillRect(ground.x,ground.y,ground.width,ground.height)}function drawObstacle(e){drawAnimatedImage(obstacleImage,e.x,e.y,0,0,1,e.height,e.width)}function drawMeteor(e){drawMeteor(meteorImage,e.x-e.radius,e.y-e.radius,2*e.radius,2*e.radius)}function clear(){ctx.clearRect(0,0,canvas.width,canvas.height)}function newPos(){player.dy+=player.gravity,player.y+=player.dy,player.x+=player.dx,player.y+player.height>ground.y&&(player.y=ground.y-player.height,player.dy=0,player.canJump=!0)}function updateObstacles(){for(let e=obstacles.length-1;e>=0;e--)obstacles[e].x-=obstacles[e].speed,obstacles[e].y-=obstacles[e].direction,obstacles[e].x%50==0&&(obstacles[e].direction*=-1),obstacles[e].x+obstacles[e].width<0&&obstacles.splice(e,1)}function createObstacle(){randomFactor=Math.floor(Math.random()*canvas.height)+70,obstacles.push({x:canvas.width,y:randomFactor,height:64,width:64,direction:Math.random()>.5?1:-1,speed:speedHard})}function updateMeteors(){for(let e=meteore.length-1;e>=0;e--)meteore[e].x+=Math.cos(meteore[e].angle)*meteore[e].speed,meteore[e].y+=Math.sin(meteore[e].angle)*meteore[e].speed,meteore[e].y-meteore[e].radius>canvas.height&&meteore.splice(e,1);meteorAngle+=.01}function createMeteor(){let e=10*Math.random()+10;meteore.push({x:Math.random()*canvas.width,y:-e,radius:e,angle:Math.random()*Math.PI,speed:speedHard})}grassImage.src="img/prato.png";let canShoottimer=100;function createFireball(){canShoot&&(fireballs.push({x:player.x+player.width/2-32*fireballRadius/5/2,y:player.y+player.height+32*fireballRadius/5,radius:fireballRadius,width:32*fireballRadius/5,height:32*fireballRadius/5}),canShoot=!1,setTimeout(()=>{canShoot=!0},canShoottimer))}function drawFireball(e){drawAnimatedImage(fireballImage,e.x,e.y-16,e.radius,0,2*Math.PI,e.width,e.height)}function updateFireballs(){powerupActive&&(createFireball(),canShoottimer=50,Date.now()-powerupStartTime>1e4&&(powerupActive=!1));for(let e=fireballs.length-1;e>=0;e--){fireballs[e].y-=fireballSpeed;for(let t=meteore.length-1;t>=0;t--){let a=fireballs[e].x-meteore[t].x,r=fireballs[e].y-meteore[t].y,l=1.5*fireballs[e].radius+meteore[t].radius;if(a<l&&a>-l&&r<l&&r>-l){meteore.splice(t,1),fireballs.splice(e,1);break}}try{for(let o=obstacles.length-1;o>=0;o--){let n=fireballs[e].x-obstacles[o].x,s=fireballs[e].y-obstacles[o].y,c=fireballs[e].radius+obstacles[o].width/2;if(n*n+s*s<c*c){obstacles.splice(o,1),fireballs.splice(e,1);let d=Math.floor(3*Math.random());switch(d){case 0:activatePowerup();break;case 1:addlife();break;case 2:immunita()}}}fireballs[e].y<0&&fireballs.splice(e,1)}catch{console.log("gi\xe0 eliminata")}}}var hit=!1;let livesElement=document.getElementById("lives");function checkCollision(){for(let e=0;e<obstacles.length;e++)if(player.x<obstacles[e].x+obstacles[e].width&&player.x+player.width>obstacles[e].x&&player.y<obstacles[e].y+obstacles[e].height&&player.y+player.height>obstacles[e].y){obstacles.splice(e,1),points++,timerElement.textContent="record : "+points;break}if(!hit){for(let t=0;t<meteore.length;t++)if(player.x<meteore[t].x+meteore[t].radius&&player.x+player.width>meteore[t].x-meteore[t].radius&&player.y<meteore[t].y+meteore[t].radius&&player.y+player.height>meteore[t].y-meteore[t].radius){meteore.splice(t,1),0==lives&&window.location.reload(),livesstring="",ismega||(lives-=1),hit=!0;for(let a=1;a<=lives;a++)livesstring+="❤️";livesElement.textContent=livesstring,intervalRed=!0;break}}}function resetHit(){hit=!1,intervalRed=!1}function update(){clear(),drawGround(),intervalRed?drawPlayerRed():drawPlayer(),newPos(),updateObstacles(),updateMeteors(),checkCollision(),obstacles.forEach(drawObstacle),meteore.forEach(drawMeteor),fireballs.forEach(drawFireball),updateFireballs(),requestAnimationFrame(update)}function moveRight(){player.dx=player.speed}function moveLeft(){player.dx=-player.speed}function stop(){player.dx=0}function jump(){player.canJump&&(player.dy=player.jumpPower,player.canJump=!1)}function goDown(){player.dy=-player.jumpPower,player.canJump=!1}function keyDown(e){"ArrowRight"===e.key||"Right"===e.key||"d"===e.key?moveRight():"ArrowLeft"===e.key||"Left"===e.key||"a"===e.key?moveLeft():"ArrowUp"===e.key||"Up"===e.key||"w"===e.key?jump():"ArrowDown"===e.key||"Down"===e.key||"s"===e.key?goDown():" "===e.key&&canShoot&&createFireball()}function keyUp(e){("ArrowRight"===e.key||"Right"===e.key||"ArrowLeft"===e.key||"Left"===e.key||"a"===e.key||"d"===e.key)&&stop()}function drawAnimatedImage(e,t,a,r,l,o,n="",s=""){let c=64,d=64;if(""!=n&&(c=n),""!=s&&(d=s),l||(l=1),o||(o=.001),ctx.save(),e[Math.round(Date.now()/o)%e.length])try{ctx.drawImage(e[Math.round(Date.now()/o)%e.length],t,a,c,d)}catch{console.log("aiutami non capisco perch\xe8 va in errore")}else try{ctx.drawImage(e[1],t,a,c,d)}catch{console.log("aiutami non capisco perch\xe8 va in errore")}ctx.restore()}function drawStaticImage(e,t,a,r,l,o){ctx.save(),ctx.translate(t+r/2,a+l/2),ctx.rotate(o),ctx.drawImage(e,-r/2,-l/2,r,l),ctx.restore()}function drawMeteor(e){var t=meteorAngle;drawStaticImage(meteorImage,e.x-e.radius,e.y-e.radius,2*e.radius,2*e.radius,t)}setInterval(()=>resetHit(),1e3),document.addEventListener("touchstart",function(e){var t=e.touches[0],a=t.clientX,r=t.clientY;canvas.height-r>canvas.height/5&&jump(),canvas.height-r<canvas.height/5&&goDown(),a<canvas.width/2?moveLeft():moveRight()},!1),document.addEventListener("touchend",function(e){stop()},!1),document.addEventListener("keydown",keyDown),document.addEventListener("keyup",keyUp),setInterval(createObstacle,2e3),setInterval(createMeteor,1500),update();let timerElement=document.getElementById("timer"),startTime=Date.now(),lastUpdateTime=0;function updateTimer(){let e=Math.floor((Date.now()-startTime)/1e3);e-lastUpdateTime>=13&&(lastUpdateTime=e,speedHard++,player.speed++,setInterval(createMeteor,1500))}function activatePowerup(){showNotification("10 sec Power Up!",1e3),powerupActive=!0,powerupStartTime=Date.now()}function addlife(){showNotification("+1 Lives",1e3),livesstring="",lives++;for(let e=1;e<=lives;e++)livesstring+="❤️";livesElement.textContent=livesstring}let lastfireballtimeot=0,ismega=!1;function immunita(){showNotification("10 sec Immunity!",1e3),ismega=!0,clearTimeout(lastfireballtimeot),lastfireballtimeot=setTimeout(()=>{fireballRadius=5,ismega=!1},1e4)}function showNotification(e,t){let a=document.getElementById("notification");a.innerText=e,a.style.display="block",setTimeout(function(){a.style.display="none"},t)}setInterval(updateTimer,100);